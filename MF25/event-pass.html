<!doctype html>
<html>

<head>
    <style>
        @font-face {
            font-family: 'Ubuntu Medium';
            src: url('{{storage_path("fonts/Ubuntu-M.ttf")}}') format('truetype');
        }

        @font-face {
            font-family: 'Source Code Pro Black';
            src: url('{{storage_path("fonts/SourceCodePro-Black.ttf")}}') format('truetype');
        }

        @font-face {
            font-family: 'Ubuntu Light';
            src: url('{{storage_path("fonts/Ubuntu-L.ttf")}}') format('truetype');
        }

        @page {
            margin: 0;
        }

        body {
            margin: 0;
            padding: 0;
            background: white;
            font-family: 'Ubuntu', arial;
        }

        .card {
            width: 53mm;
            height: 85mm;
            position: relative;
            box-sizing: border-box;
            border: 0px solid black;
            font-size: 10pt;
            color: black;
            font-family: 'Ubuntu', sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding-top: 6mm;
            padding-bottom: 5mm;
        }

        .yearContainer {
            position: absolute;
            top: 35mm;
            left: 0mm;
            font-family: "Source Code Pro Black";
            font-size: 12pt;
            color: black;
            width: 8mm;
        }

        .yearContainer p.yearNumber {
            transform: rotate(-90deg);
            transform-origin: left top;
            margin: 0;
            text-align: center;
        }

        .imageContainer {
            margin-left: auto;
            margin-right: auto;
            margin-top: 10mm;
            width: 3cm;
            height: 3cm;
        }

        .imageContainer img.qrcode {
            width: 100%;
            height: 100%;
        }

        .qr-frame-corner {
            position: absolute;
            width: 4mm;
            height: 4mm;
            border-color: black;
        }

        .qr-frame-corner.tl {
            top: -2mm;
            left: -2mm;
            border-left: 1px solid black;
            border-top: 1px solid black;
        }

        .qr-frame-corner.tr {
            top: -2mm;
            right: -2mm;
            border-right: 1px solid black;
            border-top: 1px solid black;
        }

        .qr-frame-corner.bl {
            bottom: -2mm;
            left: -2mm;
            border-left: 1px solid black;
            border-bottom: 1px solid black;
        }

        .qr-frame-corner.br {
            bottom: -2mm;
            right: -2mm;
            border-right: 1px solid black;
            border-bottom: 1px solid black;
        }

        hr.divider {
            border: none;
            border-top: 0.5px solid #ccc;
            width: 80%;
            margin: 2mm auto;
        }

        .nameContainer {
            text-align: center;
        }

        .nameContainerName {
            font-family: 'Ubuntu Medium';
            font-size: 13pt;
            letter-spacing: 0.3pt;
            margin-bottom: 0px;
        }

        .nameContainerResort {
            font-family: 'Ubuntu Medium';
            font-size: 9pt;
            margin-top: 3px;
            margin-bottom: 3px;
        }
	  
	    p.nameContainerName {
            margin: 2mm;
        }

        .access-types-container {
            position: absolute;
            /* Die 'bottom'-Eigenschaft wird jetzt inline im HTML gesetzt */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .access-type {
            font-family: 'Ubuntu Medium';
            padding: 2px 10px;
            border-radius: 1mm;
            font-size: 9pt;
            text-transform: uppercase;
            letter-spacing: 0.5pt;
            color: white;
            text-align: center;
            box-shadow: 0 0 0.5mm rgba(0, 0, 0, 0.15);
            min-width: 30mm;
            display: inline-block;
            margin-top: 0px;
            margin-bottom: 3px;
        }

        .access-tall {
            font-size: 18pt;
            padding: 6px 16px;
            border-radius: 1.8mm;
            margin-top: 0;
        }

        .access-crew { background-color: #F37020; }
        .access-visitor { background-color: #333; }
        .access-partner { background-color: #F37020; }
        .access-all-area,
        .access-aa,
        .access-aaa,
        .access-access-all-areas { background-color: #0F0F0F; }
        .access-backstage { background-color: #01944D; }
        .access-stage { background-color: #0678D8; }
        .access-produktion { background-color: #5bc0de; }

        .numberContainer {
            position: absolute;
            bottom: 1mm;
            left: 2mm;
        }

        .numberContainer p {
            font-family: "Ubuntu Light";
            font-size: 6pt;
            margin: 0;
            color: rgb(0, 0, 0);
        }

        .page-break {
            page-break-after: always;
        }
    </style>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>

<body>

    <div class="imageContainer">
        {{ qrcode|raw }}
    </div>

    <div class="nameContainer">
        <p class="nameContainerName">{{ pass.name }}</p>
        {% if pass.role|length %}
            <p class="nameContainerResort">{{ pass.role }}</p>
        {% endif %}
        {{ pass.person.applicationsAsMember[0].data['name'] }}
        {{ pass.person.teams|map(t => t.name)|join(', ') }}
	  	{{ pass.person.teams_confirmed|map(t => t.name)|join(', ') }}
    </div>

    {# ================= NEUE LOGIK START ================= #}
    {% set access_type_names = pass.person.access_types|map(t => t.name) %}
    {% set display_access = null %}

    {% if 'AAA' in access_type_names %}
        {% set display_access = 'AAA' %}
    {% elseif 'AA' in access_type_names %}
        {% set display_access = 'AA' %}
    {% endif %}

    {# 1. Zähle die Anzahl der angezeigten Bereiche #}
    {% set num_types = 0 %}
    {% if display_access %}
        {% set num_types = 1 %}
    {% else %}
        {% set filtered_types = access_type_names|filter(t => t not in ['AAA', 'AA']) %}
        {% set num_types = filtered_types|length %}
    {% endif %}

    {# 2. Bestimme die 'bottom'-Position basierend auf der Anzahl #}
    {% set bottom_position = '10mm' %} {# Standard für 1 Bereich (75mm von oben) #}
    {% if num_types == 2 %}
        {% set bottom_position = '7mm' %}  {# 78mm von oben #}
    {% elseif num_types >= 3 %}
        {% set bottom_position = '4mm' %}  {# 81mm von oben #}
    {% endif %}
    {# ================= NEUE LOGIK ENDE ================= #}

    <div class="access-types-container" style="bottom: {{ bottom_position }};">
        {% if display_access %}
            {% set type_name = display_access %}
            <span class="access-type access-tall
                {% if type_name == 'AAA' %}access-aaa
                {% elseif type_name == 'AA' %}access-aa
                {% endif %}
            ">
                {{ type_name }}
            </span>
        {% else %}
            {# Wir verwenden hier die bereits gefilterte Liste `filtered_types` #}
            {% for type_name in filtered_types %}
                <span class="access-type
                    {% if type_name == 'CREW' %}access-crew
                    {% elseif type_name == 'Visitor' %}access-visitor
                    {% elseif type_name == 'Partner' %}access-partner
                    {% elseif type_name == 'All Area' %}access-all-area
                    {% elseif type_name == 'Backstage' %}access-backstage
                    {% elseif type_name == 'Stage' %}access-stage
                    {% elseif type_name == 'Produktion' %}access-produktion
                    {% endif %}
                ">
                    {{ type_name }}
                </span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="numberContainer">
        <p class="number">{{ pass.number }}</p>
    </div>

</body>
</html>
